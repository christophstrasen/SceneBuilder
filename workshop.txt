version=1
id=3594105442
title=[42SP] SceneBuilder - A declarative scene composition framework.
description=[h1]SceneBuilder[/h1]
description=
description=[i]A declarative scene composition framework for Project Zomboid (Build 42), Single Player[/i] - part of the [url=https://github.com/christophstrasen/DREAM]DREAM[/url] family.
description=
description=SceneBuilder lets modders [b]spawn in-world scenes[/b] in a [b]declarative[/b] fashion — corpses, containers, clutter, blood, and more — using a Lua DSL.
description=Scenes are conceptually similar to [b]vanilla randomized stories[/b] (e.g. from `RBBasic`) or [b]ItemStories[/b] ([url=https://steamcommunity.com/sharedfiles/filedetails/?id=3569303590]Steam Workshop → ItemStories B42[/url]).
description=
description=Unlike those, SceneBuilder scenes are [b]not automatically distributed[/b] into the world of Project Zomboid but are [b]meant to be used by modders[/b] for any purpose.
description=
description=This framework is low-level in the sense that it does not provide opinions on what should spawn in which environments, room types etc.
description=
description=The shipped DSL can currently be extended with custom resolvers and spawn hooks.
description=
description=[code]
description=local Scene = require("SceneBuilder/core")
description=
description=Scene:begin(roomDef, { tag = "demo_lab" })
description=  :deterministic(true)
description=  :anchors(function(a)
description=    a:name("AnywhereInRoom")
description=     :where("any")
description=    a:name("deskLike")
description=     :where("tables_and_counters")
description=  end)
description=  :corpse(function(c)
description=    c:outfit("Agent")
description=     :onBody("Bag_ToolBag", "Screwdriver")
description=     :dropNear("RemoteCraftedV1", "Speaker")
description=     :blood({ bruising = 4, floor_splats = 20 })
description=     :where("any", { anchor = "deskLike", anchor_proximity = 2 })
description=  end)
description=  :container("Bag_Schoolbag_Travel", function(b)
description=    b:addTo("MoneyBundle", "Whiskey")
description=     :where("tables_and_counters", { anchor = "AnywhereInRoom" })
description=  end)
description=  :scatter(function(s)
description=    s:items("Notepad", "Pencil")
description=     :maxPlacementSquares(3)
description=     :where("any", { anchor = "AnywhereInRoom" })
description=  end)
description=  :spawn()
description=[/code]
description=
description=This is a developer library, not gameplay content. It does nothing on its own.
description=
description=[h2]Known Issues & Limitations[/h2]
description=[list]
description=[*]Build 42 only.
description=[*]Unfit for Multiplayer.
description=[*]Currently only works indoors with a RoomDef given.
description=[*]Type hinting for scene definitions is incomplete
description=[/list]
description=
description=[h2]Seeing it work[/h2]
description=Assuming that you are in debug mode [i]and your character stands in a room[/i], paste this into your in-game console:
description=[code]
description=fulldemo = require("SceneBuilder/prefabs/demo_full")
description=fulldemo.makeForRoomDef(nil)
description=[/code]
description=
description=[h2]Core Concepts[/h2]
description=[list]
description=[*][b]Scene[/b] - A one-shot composition combining multiple placers; committed via `:spawn()`.
description=[*][b]Placer[/b] - Defines [i]what[/i] to spawn (`corpse`, `container`, or `scatter`) and knows how to do it.
description=[*][b]Resolver[/b] - Defines [i]where[/i] to spawn (`"any"`, `"tables_and_counters"`, …).
description=[*][b]Anchor[/b] - A reusable reference point helpful to group focus spawn positions
description=[/list]
description=
description=[h2]Usage and Lifecycle[/h2]
description=SceneBuilder internally tracks which [i]placer[/i] is currently active and when its definition is complete.
description=
description=[h3]1. Building a Scene[/h3]
description=[list]
description=[*]A new scene begins with `Scene:begin(roomDef, opts)`.
description=[*]Each call to a placer (e.g. `:corpse`, `:container`, `:scatter`) activates that placer’s builder state until another placer begins or the scene is spawned.
description=[/list]
description=
description=[h3]2. Working within a Placer[/h3]
description=[list]
description=[*]While a placer is active, you can chain setup calls (`:outfit`, `:items`, `:blood`, …).
description=[*]Every placer [b]must[/b] define a valid `:where` before it can spawn.
description=[*]Some placers may require specific setup (e.g. `:items` for `:scatter`).
description=[/list]
description=
description=[h3]3. Committing and continuing[/h3]
description=[list]
description=[*]Starting a new placer implicitly commits the previous one (but doesn’t spawn it yet).
description=[*]You can interrupt scene construction at any time and continue later with the same `Scene` object. Just make sure the previous placer has been completed with `:where(...)`.
description=[/list]
description=
description=[h3]4. Spawning[/h3]
description=[list]
description=[*]Use `:spawnNow()` to immediately spawn all placers defined so far.
description=[*]Use `:spawn()` at the end of your builder chain to finalize and spawn everything.
description=[/list]
description=
description=[quote]
description=[b]Tip:[/b] Think of each placer as a “sub-scene.” It becomes part of the active scene once committed, and all are spawned together when `:spawn()` is called.
description=[/quote]
description=
description=[h2]Design choices[/h2]
description=[h3]Determinism[/h3]
description=Scenes are deterministic by default — same inputs yield the same layout, item selection etc.
description=Setting `:deterministic(false)` disables this.
description=
description=[h3]Bias to Spawn[/h3]
description=[quote]
description=SceneBuilder’s resolvers, placers, and fallbacks are deliberately tuned toward [i]making placements happen whenever possible.[/i]
description=The default behavior is to degrade gracefully — relaxing distance limits or falling back to simpler strategies — rather than fail outright.
description=Authors who want stricter behavior can override this by registering custom resolvers, setting `fallback = nil` or `proximity_fallback = "fail"` in their placer specs.
description=[/quote]
description=
description=[h2]Resolvers (where things go)[/h2]
description=These are used by placers and anchors to restrict which "pool" of squares they should consider. Whether a placer or anchor works on the entire pool or picks a subset of squares depends on implementation details and sometimes settings. E.g. the "Scatter" placer tries to distribute among the return squares.
description=
description=[h3]Built-in Resolvers[/h3]
description=[list]
description=[*]`any` - Free squares inside the room, including surfaces.
description=[*]`freeOrMidair` - Walkable squares (not solid/tree; allows stairs).
description=[*]`centroid` - Center-out pool based on room square centroid (good for L-shape).
description=[*]`centroidFreeOrMidair` - Centroid pool filtered to walkable squares.
description=[*]`tables_and_counters` - Valid surface squares with table or counter sprites.
description=[/list]
description=
description=Fallbacks:
description=
description=[code]
description=:where({
description=  strategy = "tables_and_counters",
description=  retries  = 4,
description=  fallback = { "any" }
description=})
description=[/code]
description=
description=If the primary resolver fails, SceneBuilder retries with each fallback in order.
description=
description=[h3]Custom Resolvers[/h3]
description=Resolvers are designed to be [b]extensible[/b] — you can define and register your own to determine [i]which squares[/i] qualify for placing under a given strategy name.
description=
description=To explore existing examples, review the shipped resolvers in the mod’s `resolvers/` directory.
description=
description=To add your own resolver, register it from anywhere:
description=
description=[code]
description=local Resolvers = require("SceneBuilder/resolvers")
description=
description=Resolvers.register("my_custom_strategy", function(roomDef, place, state)
description=  -- Return a list of IsoGridSquares that match your conditions.
description=  -- For example: all tiles tagged as medical.
description=  return matchingSquares
description=end)
description=[/code]
description=
description=Once registered, your custom resolver can be used in `:where` or `:anchor` like so:
description=
description=[code]
description=:container("Bag_Schoolbag_Travel", function(b)
description=  b:addTo("Disinfectant", "Bandage")
description=   :where("my_custom_strategy")
description=end)
description=[/code]
description=
description=[quote]
description=Strategies are global so consider namespacing and watch the log for name conflicts.
description=[/quote]
description=
description=[h2]Placers (what spawns)[/h2]
description=All placers begin with their specific call (current variants `:corpse`, `:container`, `:scatter`, `:zombies`).
description=
description=[code]
description=:corpse(function(c)
description=[/code]
description=
description=They share the same call to a [i]resolver[/i] under the friendly alias `:where`  which determines the squares that may qualify for the current placer block.
description=
description=[code]
description=:where(strategyOrSpec, [opts])
description=[/code]
description=
description=[h3]Zombies (live)[/h3]
description=Spawn live zombies around a chosen square using `addZombiesInOutfit(...)`.
description=
description=[code]
description=Scene:begin(roomDef, { tag = "demo_zombies" })
description=  :zombies(function(z)
description=    z:count(6)
description=     :outfit("Police")      -- optional (nil = random)
description=     :femaleChance(50)      -- 0..100 (percent)
description=     :where("freeOrMidair", { fallback = { "any" } })
description=  end)
description=  :spawn()
description=[/code]
description=
description=[list]
description=[*][b]`strategyOrSpec`[/b]: either a string resolver name (`"any"`, `"tables_and_counters"`, etc.) or a full table spec (`{ strategy="any", retries=4, fallback={...} }`).
description=[*][b]`opts`[/b] (optional): may include `anchor`, `anchor_proximity`, and `proximity_fallback`.
description=[/list]
description=
description=[quote]
description=Resolved items and containers automatically attempt to [b]drop at the correct surface Z-height[/b] and also adjust to a plausible x,y within the square using the [i]SpritesSurfaceDimensions[/i] polyfill.
description=[/quote]
description=
description=[b]GitHub:[/b] [url=https://github.com/christophstrasen/SceneBuilder]https://github.com/christophstrasen/SceneBuilder[/url]
description=
description=[h2]Dependencies (required by mod.info)[/h2]
description=[list]
description=[*]DREAMBase
description=[/list]
description=
description=[h2]Forking[/h2]
description=Modifications to this mod are welcome. Ideally as a PR on GitHub. You may publish your own version on the Steam Workshop under the condition that you give credit, clearly label the modded version and refer to the original. If in doubt get in touch via a GitHub issue.
tags=Framework;Build 42;
visibility=Public
